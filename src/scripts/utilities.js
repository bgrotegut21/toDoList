//helpful functions that ate tucked in this file to make content more clean and readable
import format from 'date-fns/format'
import {getUpdatedElements} from "./pageLayout.js"

const findBoardTextBox =  (index) => {
    let taskLists = getElementByBoardIndex(index,"taskLists");
    let buttonText = "could not load text"
    let taskListChildren = Array.from(taskLists.children)

   
    taskListChildren.forEach(child => {
        if (child.getAttribute("class") == "boardTextEditor") {
             buttonText = Array.from(child.children)[0].value;
             return;
        }
        
    })
    return buttonText;
}

const getElementByBoardIndex = (index,domElement) => {

    let element = getUpdatedElements();
    let newElement = false;
    element[domElement].forEach(childElement => {
        if (childElement.boardIndex == index) newElement = childElement
    })
    return newElement;


}


// only works with static list tasks which has two arrays
// one that can take different types of editors which is known as
// the changedboardlists and the one that changes very little 
// and values can be added but will be edited in the editors in changedBoardLists
const findObjectByName = (name,parentArray) => {
    let currentObject = false;
    let breakLoop;
    let staticListTasks = parentArray;

    staticListTasks.forEach(task => {
        task.changedBoardLists.forEach(listTask => {
            if (listTask[name]){
                currentObject = listTask;
                breakLoop = true
                return
            }
        })
        if (breakLoop) return;

    })

    // console.log(currentObject, "the current object")
    return currentObject;

}

// Takes staticlist tasks array does not work in any other tempalate do not try it
const getObjectValue = (currentObject, value,array) => {
    let objectValue = findObjectByName(currentObject,array);
    let newValue = false;
    if (objectValue != false) newValue = objectValue[value];
    return newValue;
}


const changeValueToDate = (value) => {
    let newValue = value.split("-");
    let year = newValue[0];
    let monthIndex = newValue[1] -1;
    let day = newValue[2];


    let date = new Date(year,monthIndex,day);
    return date;
}

const unshadeButtons = ()=> {
    let elements = getUpdatedElements();
    let buttons = elements.button;
    buttons.forEach(element => {
        let elementChildren = Array.from(element.children);
        elementChildren.forEach(childElement => {
            childElement.style.background = "none";
            // console.log(childElement, "the current child element")
        })
    })
}


const createTaskTemplate = (text,date,priority,projectTypeText,checked) => {
    let task = {}
    task.listTask = true;
    task.text = text,
    task.date = date;
    task.dateText = format(task.date,"MMM d y")
    task.priority = priority;
    !checked? task.checked = false: task.checked = true;
    if (typeof projectTypeText != "undefined")  task.projectTypeText = projectTypeText;
    return task;

}



export {findBoardTextBox, getElementByBoardIndex, getObjectValue, changeValueToDate, unshadeButtons, createTaskTemplate,findObjectByName};